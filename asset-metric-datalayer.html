<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/horizon-behavior/horizon-behavior.html">

<!--
`asset-metric-datalayer`
Data layer for asset metrics

@demo demo/index.html
-->

<dom-module id="asset-metric-datalayer">
    <script>
        Polymer({

            is: 'asset-metric-datalayer',

            behaviors: [
                WIRSENS.HorizonBehavior
            ],

            properties: {

                asset: Object,

                lastMetric: {
                    type: Object,
                    notify: true
                }

            },

            observers: [
                '_setAssetMetric(_horizon, asset)'
            ],

            _setAssetMetric: function (horizon, asset) {
                horizon('metrics').findAll({
                    deviceId: String(asset.deviceId),
                    entity: asset.entity
                })
                .order('timestamp', 'descending')
                .limit(1)
                .watch()
                .subscribe(function (metric) {
                    this.set('lastMetric', metric[0]);
                }.bind(this));
            }

        });
    </script>
</dom-module>
